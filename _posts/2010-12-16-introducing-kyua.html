---
layout: post
title: "Introducing Kyua"
date: 2010-12-16 14:11:00 -0500
categories: atf kyua netbsd
julipedia: 2010/12/introducing-kyua.html
excerpt_separator: </p>
---
Wow.  I have just realized that I have not blogged at all about the project that has kept me busy for the past two months!  Not good, not good.  "What is this project?", I hear.  Well, this project is <a href="http://code.google.com/p/kyua/">Kyua</a>.<br /><br />A bit of background first: the <a href="http://www.NetBSD.org/~jmmv/atf/">Automated Testing Framework</a>, or ATF for short, is a project that I <a href="{% post_url 2007-04-12-soc-selected-again %}">started during the Summer of Code of 2007</a>. The major goal of ATF was, and still is, to provide a testing framework for the <a href="http://www.NetBSD.org/">NetBSD</a> operating system. The ATF framework is composed of a set of libraries to aid in the implementation of test cases in C, C++ and shell, and a set of tools to ease the execution of such test cases (<tt>atf-run</tt>) and to generate <a href="http://www.gson.org/netbsd/bugs/build/build/2010.12.14.20.09.43/test.html">reports</a> of the execution (<tt>atf-report</tt>).<br /><br />At that point in time, I would say that the original design of ATF was nice.  It made test programs intelligent enough to execute their test cases in a sandboxed environment.  Such test programs could be executed on their own (without <tt>atf-run</tt>) and they exposed the same behavior as when they were run within the runtime monitor, <tt>atf-run</tt>.  On paper this was nice, but in practice it has become a hassle.  Additionally, some of these design decisions mean that particular features (in particular, parallel execution of tests) cannot be implemented at all.  At the end of 2009 and beginning of 2010, I did some <a href="{% post_url 2010-03-06-introducing-atf-nofork-branch %}">major refactorings</a> to the code to make the test programs dumber and to move much of the common logic into <tt>atf-run</tt>, which helped a lot in fixing the major shortcomings encountered by the users... but the result is that, today, we have a huge mess.<br /><br />Additionally, while ATF is composed of different modules conceptually separate from each other, there is some hard implementation couplings among them that impose severe restrictions during development.  Tangentially, during the past 2 years of working at Google (and coding mainly in Python), I have been learning new neat programming techniques to make code more testable... and these are not followed at all by ATF.  In fact, while the test suite of ATF seems very extensive, it definitely is not: there are many corner cases that are not tested and for which implementing tests would be <i>very</i> hard (which means that nasty bugs have easily sneaked in into releases).<br /><br />Lastly, a very important point that affects directly the success of the project.  Outsiders that want to contribute to ATF have a huge entry barrier: the source repository is managed by <a href="http://www.monotone.ca/">Monotone</a>, the bug tracker is provided by Gnats (a truly user-unfriendly system), and the mailing lists are offered by majordomo. None of these tools is "standard" by today's common practices, and some of them are tied to NetBSD's hosting which puts some outsiders off.<br /><br />For all the reasons above and as this year has been moving along, I have gotten fed up with the ATF code base.  (OK, things are not <i>that</i> bad... but in my mind they do ;-)  And here is where Kyua comes into the game.<br /><br /><a href="http://code.google.com/p/kyua/">Kyua</a> is a project to address all the shortcomings listed above.  First of all, the project uses off-the-shelf development tools that should make it much, much easier for external people to contribute.  Secondly, the project intends to be much more modular, providing a clear separation between the different components and providing code that is easily testable.  Lastly, Kyua intends to remain compatible with ATF so that there are no major disruptions for users.  You can (and should) think of Kyua as ATF 2.0, not as a vastly different framework.<br /><br />As of today, Kyua implements a runtime engine that is on par, feature-wise, to the one provided by <tt>atf-run</tt>.  It is able to run test cases implemented with the ATF libraries and it is able to test itself.  It currently contains 355 test cases that run in less than 20 seconds.  (Compare that to the 536 test cases of ATF, which take over a minute to run, and Kyua is still really far from catching up with all the functionality of ATF.)  Next actions involve implementing reports generation and configuration files.<br /><br />Anyway.  For more details on the project, I recommend you to read the <a href="http://mail-index.netbsd.org/atf-devel/2010/11/13/msg000206.html">original posting to atf-devel</a> or the project's <a href="http://code.google.com/p/kyua/">main page</a> and <a href="http://code.google.com/p/kyua/w/list">wiki</a>.  And of course, you can also download the preliminary source code to take a look!<br /><br />Enjoy :-)
