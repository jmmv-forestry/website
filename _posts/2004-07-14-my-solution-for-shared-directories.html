---
layout: post
title: "My solution for the 'shared directories' problem"
date: 2004-07-14 12:03:00 -0400
categories:
julipedia: 2004/07/my-solution-for-shared-directories.html
excerpt: Post imported from The Julipedia; excerpt not available.
---
<p>The previous post explained a problem in pkgviews WRT directories used by a program where other packages can install files; the most typical example are directories holding plugins. It also outlined two possible solutions, or better said, workarounds. I'll explain my solution here, which is already implemented but waiting for approval.</p>  <p>The idea is to "configure" programs at <i>run time</i> to let them access the view from where they are executed. This is very easy to do: we just have to patch all programs that have this problem so that they use a global environment variable, say <tt>PKG_VIEWBASE</tt>, that points to the root directory of the view being used. Picking the XMMS example again, the program could be modified to search for its input plugins from <tt>${PKG_VIEWBASE}/lib/Input</tt>, falling back to its depot directory if the variable is not set.</p>  <p>You may now think: "but hey, I have to manually set an environment variable before running programs!". True. But this can be worked around by changing the semantics of pkgviews a bit. That is, instead of creating symlinks for executables, we'd have to create wrappers. The task of these small wrappers is simply to set up the environment variable and then launch the real program.</p>  <p>For example, to make it clearer, <tt>/usr/pkg/bin/xmms</tt> could be this piece of code:</p>  <pre>#!/bin/sh <p>PKG_VIEWBASE=/usr/pkg; export PKG_VIEWBASE</p> <p>/usr/pkg/packages/xmms-1.2.10/bin/xmms "$@"</p></pre><p></p>  <p>As you can see, this script also has hardcoded paths in it, but these were written when the package was added to the view. If I want to add XMMS to another view after its installation, I can easily do it, and the appropiate wrapper will be generated <i>on the fly</i> with the right paths.</p>  <p>You may argue that adding a new variable is not needed in some cases, as programs provide their own way to specify the location of files at run time (for example, <tt>PKG_CONFIG_PATH</tt> in pkgconfig). I know; this is why these wrappers can be easily extended (on a package basis) to override more environment variables (like this one), which simplifies maintenance in such programs (less patches).</p>  <p>Nice, eh? ;-) As I said, this is already implemented and works well for me. When I've got an 'Ok' from one of the main developers of pkgviews, I'll start fixing all programs (basically, GNOME) to use the new environment variable.</p><p class="mobile-post"></p>
