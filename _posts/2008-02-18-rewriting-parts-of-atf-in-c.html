---
layout: post
title: "Rewriting parts of ATF in C"
date: 2008-02-18 05:22:00 -0500
categories: atf c
julipedia: 2008/02/rewriting-parts-of-atf-in-c.html
excerpt_separator: </p>
---
I have spent part of past week and this whole weekend working on a C-only library for ATF test programs. An extremely exhausting task.  However, I wanted to do it because there is reluctancy in NetBSD to write test programs in C++, which is understandable, and delaying it more would have made things worse in the future.  I found this situation myself some days ago when writing tests for very low level stuff; using C++ there felt clunky, but it was still possible of course.<br /><br />I have had to reimplement lots of stuff that are given for-free in any other, <i>higher</i>-level (not necessarily <i>high</i>-level) language.  This includes, for example, a "class" to deal with dynamic strings, another one for dynamic linked lists and iterators, a way to propagate errors until the point where they can be managed... and I have spent quite a bit of time debugging crashes due to memory management bugs, something that I rarely encountered in the C++ version.<br /><br />However, the new interface is, I believe, quite neat.  This is not because of the language per se, but because the C++ interface has grown "incorrectly". It was the first code in the project and it shows.  The C version has been written from the ground up with all the requirements known beforehand, so it is cleaner.  This will surely help in cleaning up the C++ version later on, which cannot die anyway.<br /><br />The code for this interface is in a new branch, <a href="http://mtn-host.prjek.net/viewmtn/atf/branch/changes/org.NetBSD.atf.src.c">org.NetBSD.atf.src.c</a>, and will hopefully make it to ATF 0.5: it still lacks a lot of features, hence why it is not on mainline.  Ah, the joys of a distributed VCS: I have been able to develop this experiment locally and privately until it was decent enough to be published, and now it is online with all history available!<br /><br />From now on C++ use will be restricted to the ATF tools inside ATF itself, and to those users who want to use it in their projects.  Test cases will be written using the C library except for those that unit-test C++ code.
