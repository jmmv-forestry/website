---
layout: post
title: "More on LOCAL_CREDS"
date: 2006-08-28 08:50:00 -0400
categories: credentials netbsd sockets
julipedia: 2006/08/more-on-localcreds.html
excerpt: Post imported from The Julipedia; excerpt not available.
---
One of the problems of learning new stuff based on trial-and-error iterations is that it is very easy to miss important details...  but that's the price to pay when there is no decent documentation available for a given feature.  We saw <a href="http://julipedia.blogspot.com/2006/08/localcreds-socket-credentials.html">yesterday</a> multiple details about <tt>LOCAL_CREDS</tt> socket credentials and, as you may deduce, I missed some.<br /><br />First of all I assumed that setting the <tt>LOCAL_CREDS</tt> option only affected the next received message (I didn't mention this explicitly in the post though).  It turns out that this is incorrect: enabling this option makes the socket transmit credentials information on each message until the option is disabled again.<br /><br />Secondly, setting the <tt>LOCAL_CREDS</tt> option on a server socket (one configured with the <tt>listen(2)</tt> call) results in all sockets created from it through <tt>accept(2)</tt> to also carry the flag enabled.  In other words, it is inherited.<br /><br />These features are interesting because, when using combined, avoid the need for the synchronization protocol outlined in the previous post â€” in some cases only.  If the credentials are to be transmitted at the very beginning of the connection, the server can follow these steps:<br /><ol><li>Create the server socket and configure it with <tt>bind(2)</tt> and <tt>listen(2)</tt>.</li><li>Before entering the <tt>accept(2)</tt> loop, set the <tt>LOCAL_CREDS</tt> option on the server socket.</li><li>Enter the <tt>accept(2)</tt> loop and start accepting clients.</li><li>For each new client:</li><ol><li>Receive its first message.</li><li>Get the credentials from it.</li><li>Disable the <tt>LOCAL_CREDS</tt> option from the socket used to communicate with that specific client.</li></ol></ol>It couldn't be easier!  This is still different to all other socket credentials methods I know of but can be easily adapted to protocols that were not designed to support <tt>LOCAL_CREDS</tt> (i.e. that do not implement the synchronization explained in the previous post).
