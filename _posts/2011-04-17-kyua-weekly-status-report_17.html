---
layout: post
title: "Kyua: Weekly status report"
date: 2011-04-17 15:29:00 -0400
categories: atf kyua report
julipedia: 2011/04/kyua-weekly-status-report_17.html
excerpt: Post imported from The Julipedia; excerpt not available.
---
<div>This week started easy:</div><ul><li>Added integration tests for the <b>about</b> and <b>help</b> subcommands. These were pretty easy to do.</li><li>Added integration tests for the <b>list</b> subcommand. I initially added these tests as <i>expected failures</i> to reason about the appearance and behavior of this command from the point of view of the user before actually working on the code... and I am still writing such code to make these tests pass!</li></ul><div>This is where things got a bit awry. Polishing the behavior of the list command so that its interface is consistent among all flag and argument combinations is tricky and non-trivial. I ended up having to change code deep down in the source tree to implement missing features and to change existing bits and pieces:</div><div><div><ul><li>Implemented support to print all test case properties, not only the user-specific ones. The properties recognized by the runtime engine are stored as individual arguments of a structure, so these required some externalization code.</li><li>Implemented "test case filtering". This allows users to select what tests to run on the command line at the test case granularity. For example, <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">foo/bar</span> selects all tests in a subdirectory if <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">bar</span> is a directory, or all the tests in the <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">bar</span> test program if it is a binary. But what is new (read: not found in ATF) is that you can even do <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">foo/bar:test-1</span> where <span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">test-1</span> is the name of a test case within the foo/bar test program. I've been silently wishing for this feature to be available in ATF because it shortens the build/test/edit cycle, but it was not easy to add.</li><li>Changed the internal representation of test suites to ensure all test program names are relative to the root of the test suite. The root of the test suite is considered to be the directory in which the top-level Kyuafile lives (<span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">/usr/tests/</span> in NetBSD). The whole point of doing this is to provide some consistency to the filters when the user decides to execute tests that are not in the current directory. For example, the following are now equivalent:<br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">$ cd /usr/tests &amp;&amp; kyua list fs/tmpfs</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">$ kyua list -k /usr/tests/Kyuafile fs/tmpfs</span></li></ul></div></div><div>The plans for the upcoming week are to finish with the clean up of the list command (which involves adding proper error reporting, refactoring of the command module and addition of unit tests) and start cleaning up the test command.</div><div><br /></div><div>Also, remember that <a href="http://www.bsdcan.org/2011/">BSDCan 2011</a> is now around the corner and that <a href="http://www.bsdcan.org/2011/schedule/events/223.en.html">I will be talking about ATF, Kyua and NetBSD</a> in it! &nbsp;My plan was to have a kyua-cli-0.1 release by the time of the conference, although this will be tricky to achieve...</div>
