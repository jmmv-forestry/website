---
layout: post
title: "VirtualBox and port forwarding (and Fusion)"
date: 2011-09-19 17:57:00 -0400
categories: virtualization
julipedia: 2011/09/virtualbox-and-port-forwarding-and.html
excerpt_separator: </p>
---
I have been a <a href="http://www.vmware.com/products/fusion/overview.html">VMware Fusion</a> user for a long time and I think I am about to be a <a href="http://www.virtualbox.org/">VirtualBox</a> convert. Let me explain you my story.<br /><br />With the release of the <a href="http://msdn.microsoft.com/en-us/windows/home/br229518">Windows 8 Developer Preview</a>, I felt like giving the system a try. Not because I particularly like or care about Windows, but just because I am genuinely curious about operating systems and wanted to check out their new Metro interface. So I went ahead, downloaded the ISO image, created a new virtual machine under Fusion 3, started the virtual machine, and saw Fusion crash while the Windows installer was booting.<br /><br />Oh well, an emulation problem. I tried to fiddle with the virtual machine settings a bit, selecting different CPU virtualization settings and different hardware devices. No luck. After that, I resorted to Google to look for a solution to the problem and found that other people were experiencing the same issue. But, at the same time, I also found that VMware had just released Fusion 4 and that this new release works with Windows 8 just fine. Ah, cool! Or not... $50 for the upgrade. For my use cases (which amount to booting a few BSD and Linux virtual machines in console mode), it is hard to justify the upgrade â€” specially when it would just be to fulfill my curiosity and then delete the virtual machine 10 minutes later.<br /><br />But wait! There is that thing called VirtualBox. I had used this product a while ago and did not enjoy doing so because its interface was utterly (really) confusing. It was nowhere near the polish of Fusion or Parallels. However, to my surprise, most of my major itches have been fixed and the new interface of VirtualBox is bearable. And it boots the Windows 8 preview just fine!<br /><br />Right. So after installing Windows 8, playing with it for 10 minutes, and later deleting it, I decided to look around and see what else VirtualBox has to offer. It has <i>many</i> settings. Yes, I know, Fusion has many settings too, but most are hidden from the UI and can only be accessed by modifying the <tt>vmx</tt> text file. In the case of VirtualBox they are easily accessible.<br /><br />I kept looking around... and there it was, the "<b>Port Forwarding</b>" option staring at me under the Network settings.<br /><br />One of the features I've been wishing for a long, long, <i>long</i> time is the ability to easily configure a NATed (not bridged) virtual machine in my laptop, assign a host name to it from the graphical interface and then be able to SSH into the virtual machine from the laptop. As it turns out, this is doable in Fusion but it requires some nasty tinkering: one has to edit a <i>dhcpd</i> configuration file by hand to add a new stanza for the virtual machine (<tt>/Library/Application Support/VMware Fusion/vmnet8/dhcpd.conf</tt>). This involves manually copy/pasting the MAC address of the virtual machine into that file (which you must first extract from the <tt>vmx</tt> file), assigning it an IP in the corresponding subnet, and sticking the IP plus host name in the <tt>/etc/hosts</tt> file. This gets boring pretty quickly.<br /><br />VirtualBox may or may not support this kind of setting, but it has the aforementioned "Port Forwarding" option which is interesting on its own. As you can imagine, this sets up forwarding of a port from the host system to a port of the virtual machine. Creating an entry for SSH is as easy as clicking a couple of buttons, choosing a local port on the host system (e.g. 2022) and forwarding it to port 22 of the guest system. Voila. You can now access your virtual machine locally <i>and remotely</i> without having to go through any of the host name nor DHCP madness I experienced before:<br /><br /><tt>$ ssh -p 2022 localhost</tt><br /><br />You can later create an alias in your <tt>~/.ssh/config</tt> file to make accessing the virtual machine a breeze:<br /><br /><tt>Host myvm</tt><br /><tt>Hostname localhost</tt><br /><tt>Port 2022</tt><br /><br />And later:<br /><br /><tt>$ ssh myvm</tt><br /><br />It couldn't be easier. This trivial feature is a killer for the kind of environment I am interested in. And I also know that VirtualBox provides some other interesting features, like headless mode, that are not (easily) available with Fusion.<br /><br />So yes, I think I am a convert.
