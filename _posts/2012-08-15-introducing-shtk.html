---
layout: post
title: "Introducing shtk"
date: 2012-08-15 17:39:00 -0400
categories: announce netbsd shell
julipedia: 2012/08/introducing-shtk.html
excerpt: Post imported from The Julipedia; excerpt not available.
---
Have you ever wanted to have a collection of ready-to-use modules for shell scripts? I have, particularly because I keep reimplementing the same functions over and over and over and over again whenever I write non-trivial shell scripts, and I'm tired of doing so.<br /><br />That's why I have just abstracted all the common code in the aforementioned tools and <a href="http://mail-index.netbsd.org/pkgsrc-changes/2012/08/15/msg077072.html">put it into a new package called the "Shell Toolkit", or shtk for short</a>. Yeah, this name sounds very pretentious but, really, I don't intend this to be anything big. The only thing I want to do is simplify my life when implementing shell scripts, and hope that other people might find the modules useful. So far, I have taken the generic (and common!) code from sysbuild and sysupgrade, reconciled a few tiny divergences, and moved it into this new shtk package.<br /><br class="Apple-interchange-newline" />In reality, writing something like shtk is sin-borderline. I really should not be using shell scripting for the kind of tools I am implementing (they deserve better data structures and better error checking than what shell provides, for example). However, shell scripting is incredible convenient to get reasonably-good implementations of such tools with minimal effort, and is the only scripting language available in NetBSD's base system. (Yes, yes, there is Lua, but my limited knowledge of Lua would not let me write these tools in any decent manner nor in any reasonable time.)<br /><div><br /></div>So, what's in shtk? There are a few functions to deal with command lines (error/warning reporting and such things), some trivial stuff to deal with lists, a bunch of code to interact with cvs and, what I like the most, a module to implement configuration files with some kind of key/value validation.<br /><br />At the moment, shtk can only be found in pkgsrc under <a href="http://cvsweb.netbsd.org/bsdweb.cgi/pkgsrc/devel/shtk?only_with_tag=MAIN">pkgsrc/devel/shtk</a>&nbsp;and I don't currently have any plans to make it more widely available. If there are enough people interested in that with real needs, I could reconsider, but the maintenance effort would be non-trivial.<br /><br />To showcase the features of shtk, I have updated the sysbuild and sysupgrade packages to depend on this new toolkit while at the same time dropping all this duplicate supporting code. It's a good thing that I wrote exhaustive tests for all possible code paths, because the migration from the built-in modules to shtk was riddled with subtleties that would have impacted end users otherwise.<br /><br />Now... time to really consider taking the task of rewriting pkg_comp in a more&nbsp;maintainable&nbsp;style so that I can add the features I have wished for for many years (like OS X support).
