---
layout: post
title: "Understanding patches"
date: 2004-07-23 17:11:00 -0400
categories:
julipedia: 2004/07/understanding-patches.html
excerpt_separator: </p>
---
<p>A <i>patch</i> is a plain text file that describes the <i>differences</i> (and nothing else) between two different files. They are a very convenient way to provide modifications to programs - you modify the sources, generate a patch and submit it back to the mainstream author - as they describe exactly what you changed. The original can easily check your modifications and decide if they are wrong or not.</p>  <p>Patches are very easy to understand, assuming they are in <i>unified</i> format (the only one I'm going to explain here).  Let's see an example to make things clear.  We start with two files, called <tt>file1</tt> and <tt>file2</tt>.  <tt>file1</tt> contains the following:</p>  <pre>This is the first line.<br />A line of text.<br />This is the last line.</pre><p></p>  <p>And <tt>file2</tt> contains:</p>  <pre>This is the first line.<br />A modified line of text.<br />This is the last line.</pre><p></p>  <p>To generate the patch between these two files, just do: <tt>diff -u file1 file2</tt> (note that the <i>original</i> file goes first, while the <i>modified</i> goes last).  The output of this command will be something like:</p>  <pre>--- file1       2004-07-23 22:59:00.000000000 +0200<br />+++ file2       2004-07-23 22:59:05.000000000 +0200<br />@@ -1,3 +1,3 @@<br />This is the first line.<br />-A line of text.<br />+A modified line of text.<br />This is the last line.</pre><p></p>  <p>The first two lines are the <i>header</i>. The first - the one that starts with three dashes - shows the name of the original file and its timestamp. The second - starting with three plus signs - has the same information but for the destination file. The second line is specially important, as the patch(1) utility will use the name in it to look for the file to be modified. More on this below.</p>  <p>After the header, there come several <i>chunks</i>, which are identified by the lines starting and ending with <tt>@@</tt>. They define the position in the original file where the chunk has to be applied (I've never understood them very well, so can't explain this in detail).</p>  <p>Inside each chunk there is a block of text (the four last lines of my example).  Lines starting with a dash mean lines <i>removed</i> from the file (<tt>file1</tt>).  Lines starting with a plus sign mean lines <i>added</i> to the file (<tt>file2</tt>).  At last, lines starting with a single space describe the <i>context</i> of the changes: they are used by the patch utility to locate the exact chunk of the file (i.e., those lines are searched around the position specified in the chunk's header).</p>  <p>When you have two completely unrelated files, "removed" and "added" don't have any real meaning (but in that case, why do you want to do a patch ;-). But when you are modifying an existing file, they do.</p>  <p>As you can see, the patch just includes the lines that differ (and some others that surround the change). But, if the file is large, all the parts of it that haven't been touched won't be included in the patch, thus saving a lot of space.</p>  <p>At last, suppose you have <tt>file1</tt> on your computer and I send you the patch in a file named <tt>patch.diff</tt> so that you can get <tt>file2</tt>.  How do you apply these changes?  Easy.  Start by copying (or renaming) <tt>file1</tt> to <tt>file2</tt>; patch(1) will look for the later as it appears in the second line of the header (remember I said the name on the second line was important? this is why). Then, just apply the patch: <tt>patch -p0 &lt;patch.diff</tt>.  The program will backup the original file as file2.orig and the new copy of file2 will have all the changes applied.  Nice, eh? ;-)</p><p class="mobile-post"></p>
