---
layout: post
title: "Introducing sysupgrade for NetBSD"
date: 2012-08-06 13:32:00 -0400
categories: announce netbsd
julipedia: 2012/08/introducing-sysupgrade.html
excerpt_separator: </p>
---
Over the last two weeks, you might have had fun <a href="/2012/07/introducing-sysbuild-for-netbsd.html">rolling your own NetBSD binary releases with sysbuild</a>. But what fun is that if you have no trivial way of upgrading your existing NetBSD installation to a newer version?<br /><br />Upgrading NetBSD to a newer version from distribution sets generally looks like the following;<br /><ol><li>Fetch new distribution sets (or roll your own).</li><li>Upgrade the kernel.</li><li>Unpack the distribution sets over the root directory, without fat-fingering the command and unpacking <tt>etc.tgz</tt> along the way.</li><li>Use <tt>etcupdate</tt> to merge new changes to configuration files.</li><li>Use <tt>postinstall</tt> to validate the upgraded system.</li></ol><b>Simple? Yes. Easy? No.</b> The above procedure is obscure to anyone new to NetBSD. (Actually, if you tell anybody that the way to upgrade your machine is by unpacking tarballs over <tt>/</tt> will stare at you thinking you are kidding. It's 2012.) "Jokes" aside, what is worse is that the procedure is quite monotonous and, therefore, it is very easy for the administrator to make a trivial mistake along the way and screw up a running system. (Been there, done that... multiple times.)<br /><br />Machines are made to automate trivial and repetitive tasks like the above, and they are actually very good at that. Over the years, I have performed NetBSD updates manually and later written crappy, unreliable scripts to do the upgrades for me. These scripts have never been reusable and they haven't dealt with error conditions gracefully. Furthermore, because these scripts live in my home directory, I have to remember to carry them around every time I set up a new NetBSD box.<br /><br />It was about time I sat down and rewrote my custom scripts into something more "decent". Something with documentation, with a configuration file, and with tests.<br /><br />So today, and for all the reason above, I am <a href="http://mail-index.netbsd.org/pkgsrc-changes/2012/08/06/msg076544.html">introducing sysupgrade</a>.<br /><br />sysupgrade is a script that automates (trivializes) the whole process of upgrading an existing NetBSD installation to a newer release,&nbsp;be it the currently-running system or a non-live system. sysupgrade does so by following the steps outlined above and is coordinated by a configuration file. You can find the tool in <a href="http://cvsweb.netbsd.org/bsdweb.cgi/pkgsrc/sysutils/sysupgrade/?only_with_tag=MAIN"><span id="goog_1890316919"></span>pkgsrc/sysutils/sysupgrade<span id="goog_1890316920"></span></a>, next to sysbuild. The bundled <tt>sysupgrade(8)</tt> and <tt>sysupgrade.conf(5)</tt> manual pages, and the default <tt>sysupgrade.conf</tt> configuration file should get you started and hopefully answer most of your questions.<br /><br />For the impatient, the following command would upgrade your machine to the specified version target:<br /><br /><tt>$ sysupgrade auto </tt><br /><tt>&nbsp; &nbsp; ftp://ftp.NetBSD.org/pub/NetBSD/NetBSD-&lt;X.Y.Z&gt;/$(uname -m)</tt><br /><br />At the moment, please consider sysupgrade to be experimental. It works well for me on my various machines (running both NetBSD 6.0 BETA and -current), and I have been using the upgrade procedure outlined above for years without issues. However, as with any shiny-new software, be careful. If you use NetBSD on a virtual machine, take a snapshot before running this tool; I don't think your machine is going to blow up, but better safe than sorry!<br /><br />Enjoy, and feedback very welcome!<br /><br />PS: There is lots of room for improvement. The <tt>TODO</tt> file in the package directory includes some of the ideas I'd like to work on later.
