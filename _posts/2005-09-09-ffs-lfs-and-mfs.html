---
layout: post
title: "FFS, LFS and MFS"
date: 2005-09-09 05:05:00 -0400
categories:
julipedia: 2005/09/ffs-lfs-and-mfs.html
excerpt: Post imported from The Julipedia; excerpt not available.
---
<p>The designers of the Fast File System (FFS) organized it in two different layers aiming for flexibility and code reuse; this happened in 4.4BSD (or maybe earlier, I don't know for sure). The upper layer communicates with the VFS and vnode code while the lower layer accesses the underlying devices and only receives requests from the upper layer. It goes like this:</p>  <p><tt>VFS/vnode calls &lt;-&gt; FFS upper layer &lt;-&gt; FFS lower layer &lt;-&gt; backing device</tt></p>  <p>The upper layer handles all logical details of a Unix file-system, abstracting, among many other things, inode representation and management, tree manipulations and verification of credentials. It also lays out data in different blocks and passes them to the lower layer.</p>  <p>The lower layer receives the blocks generated by the upper layer and lays them out on the physical device (e.g., a disk). It is also responsible of reading the blocks requested by the upper layer and transferring them to it.</p>  <p>Thanks to this design, three different lower layers were implemented, providing three file-systems:</p>  <ul> <li>Fast File System (FFS): It assumes that the average file size is small and that some files (those in the same directory) will be accessed all at once. Given these assumptions, it divides the disk surface in different cylinder groups and lays out blocks that may be accessed together in the same group. This reduces expensive seeks.</li>  <li>Log-structured File System (LFS): It assumes that the system bottleneck are writes to the disk, so it packs all writes in a concrete area of the disk, treating the overall space as an append-only log (no seeks required).</li>  <li>Memory File System (MFS): Reserves a contiguous region of memory and lays out blocks in it. This is why MFS is considered inefficient, because it is using the concepts of an on-disk file-system over memory.</li> </ul>  <p>The different layers are clearly visible in the source code.  The <a href="http://cvsweb.netbsd.org/bsdweb.cgi/src/sys/ufs/ufs/"><tt>src/sys/ufs/ufs</tt></a> directory contains the upper layer's code while <a href="http://cvsweb.netbsd.org/bsdweb.cgi/src/sys/ufs/ffs/"><tt>src/sys/ufs/ffs</tt></a>, <a href="http://cvsweb.netbsd.org/bsdweb.cgi/src/sys/ufs/lfs/"><tt>src/sys/ufs/lfs</tt></a> and <a href="http://cvsweb.netbsd.org/bsdweb.cgi/src/sys/ufs/mfs/"><tt>src/sys/ufs/mfs</tt></a> contain the three respective lower layers.</p>  <p>Note that the above is an over-simplification of the Real Thing (TM).  If you want detailed information, read Chapter 6 of <i>The Design and Implementation of the 4.4 BSD Operating System</i>.</p><p class="mobile-post"></p>
