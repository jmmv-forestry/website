---
layout: post
title: "Monotone's CVS gateway, part 2"
date: 2005-07-06 11:52:00 -0400
categories:
julipedia: 2005/07/monotones-cvs-gateway-part-2.html
excerpt_separator: </p>
---
<p>After explaining what is the <a href="http://www.venge.net/monotone/">Monotone's CVS gateway</a>, I've been asked to post a little step by step tutorial about it.  I'll focus the example towards <a href="http://www.pkgsrc.org/">pkgsrc</a>.  Here it goes:</p>  <p>The first step is to create a local database for Monotone and a key for personal use:</p>  <pre>$ monotone --db=~/pkgsrc.db db init<br />$ monotone --db=~/pkgsrc.db genkey user@example.com</pre><p></p>  <p>Once this is done, we can proceed to import the CVS repository into the database.  We can do this in two different ways:</p>  <ul> <li><p>Import the files from the repository, thus getting all the history in our local Monotone database. This might be appropriate in some cases, but may take a very long time and may not be worth it. This is done by doing:</p>       <pre>$ monotone --db=~/pkgsrc.db --branch=org.pkgsrc cvs_pull    :ext:anoncvs@anoncvs.NetBSD.org:/cvsroot pkgsrc</pre> </li><p></p>  <li><p>Import the files from a local working copy. This has the advantage of being a very fast operation, but you won't have old revision history in your database. This can be achieved issuing:</p>  <pre>$ cd /usr/pkgsrc<br />$ monotone --db=~/pkgsrc.db --branch=org.pkgsrc cvs_takeover</pre></li><p></p> </ul>  <p>After any of these two steps, you'll get an <tt>org.pkgsrc</tt> branch in your local Monotone database. So the next thing to do is to check out a copy of it (just as you'd do in CVS after an import operation):</p>  <pre>$ cd<br />$ monotone --db=~/pkgsrc.db --branch=org.pkgsrc checkout pkgsrc</pre><p></p>  <p>This will create a working copy under <tt>~/pkgsrc</tt>; you can change the name of the directory by changing the last word of the command.</p>  <p>And now it's time to start working on your copy.  Edit the files you want and do as many commits as you want (<tt>monotone commit</tt>).  You can examine your changes by viewing the log (<tt>monotone log</tt>), examining annotated changes (<tt>monotone annotate</tt>) or any other thing you want.  The interface is very similar to that of CVS.</p>  <p>At last, when you are ready to publish your changes to the original CVS repository, you can do so using the <tt>cvs_push</tt> command, as in:</p>  <pre>$ cd ~/pkgsrc<br />$ monotone --db=~/pkgsrc.db cvs_push</pre><p></p>  <p>Keep in mind that your Monotone repository is completely independent from the CVS one. Therefore, you may want to periodically repeat the <tt>cvs_pull</tt> operation to bring new CVS revisions into your Monotone tree, and use <tt>cvs_push</tt> to send your custom revisions to the CVS repository. I'm not sure about what will happen in case of conflicts, but I'd expect a new head in the branch that you must manually merge with the other one (using <tt>monotone merge</tt>).</p><p class="mobile-post"></p>
