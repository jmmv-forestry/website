---
layout: post
title: "Silencing the output of Python's subprocess.Popen"
date: 2009-01-05 07:02:00 -0500
categories: process python
julipedia: 2009/01/silencing-output-of-pythons.html
excerpt: Post imported from The Julipedia; excerpt not available.
---
I'm learning Python these days while writing an script to automate the testing of ATF under multiple virtual machines.  I had this code in a shell script, but it is so ugly and clumsy that I don't even dare to add it to the repository.  Hopefully, the new version in Python will be more robust and versatile enough to be published.<br /><br />One of the things I've been impressed by is the <tt>subprocess</tt> module and, in special, its <tt>Popen</tt> class.  By using this class, it is trivial to spawn subprocesses and perform some IPC with them.  Unfortunately, <tt>Popen</tt> does not provide any way to silence the output of the children.  As I see it, it'd be nice if you'd pass an <tt>IGNORE</tt> flag as the stdout/stderr behavior, much like you can currently set those to <tt>PIPE</tt> or set stderr to <tt>STDOUT</tt>.<br /><br />The following trivial module implements this idea.  It extends <tt>Popen</tt> so that the callers can pass the <tt>IGNORE</tt> value to the stdout/stderr arguments.  (Yes, it is trivial but it is also one of the first Python code I write so... it may contain obviously non-Pythonic, ugly things.)  The idea is that this exposes the same interface so that it can be used as a drop-in replacement.  OK, OK, it lacks some methods and the constructor does not match the original signature, but this is enough for my current use cases!<br /><br /><pre>import subprocess<br /><br /><br />IGNORE = -3<br />STDOUT = subprocess.STDOUT<br />assert IGNORE != STDOUT, "IGNORE constant is invalid"<br /><br /><br />class Popen(subprocess.Popen):<br />    """Extension of subprocess.Popen with built-in support<br />       for silencing the output channels of a child process"""<br /><br />    __null = None<br /><br />    def __init__(self, args, stdout = None, stderr = None):<br />        subprocess.Popen.__init__(self, args = args,<br />            stdout = self._channel(stdout),<br />            stderr = self._channel(stderr))<br /><br />    def __del__(self):<br />        self._close_null()<br /><br />    def wait(self):<br />        r = subprocess.Popen.wait(self)<br />        self._close_null()<br />        return r<br /><br />    def _null_instance(self):<br />        if self.__null == None:<br />            self.__null = open("/dev/null", "w")<br />        return self.__null<br /><br />    def _close_null(self):<br />        if self.__null != None:<br />            self.__null.close()<br />            self.__null = None<br />        assert self.__null == None, <br />            "Inconsistent internal state"<br /><br />    def _channel(self, behavior):<br />        if behavior == IGNORE:<br />            return self._null_instance()<br />        else:<br />            return behavior</pre>By the way, <a href="http://mail.python.org/pipermail/python-dev/2006-June/065868.html">somebody else suggested this same thing</a> a while ago.  Don't know why it hasn't been implemented in the mainstream <tt>subprocess</tt> module.
