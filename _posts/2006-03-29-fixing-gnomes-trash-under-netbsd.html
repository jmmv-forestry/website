---
layout: post
title: "Fixing GNOME's trash under NetBSD"
date: 2006-03-29 15:52:00 -0500
categories:
julipedia: 2006/03/fixing-gnomes-trash-under-netbsd.html
excerpt_separator: </p>
---
For a very long long time (probably since forever), the trash icon in GNOME has not worked in NetBSD.  You'd drag files onto it and they were appropriately deleted but, unfortunately, the trash did not update its status to reflect the removed files.  If you opened the folder, it appeared empty despite <tt>~/.Trash</tt> contained the deleted files.  As you can image this was very annoying as it made the trash near to useless.<br /><br />However, and by pure luck, some days ago I noticed that the trash icon showed some files on my machine.  For a moment I thought that the problem had been fixed with GNOME 2.14.0.  But I was wrong: <tt>~/.Trash</tt> didn't contain the files shown in the trash window; the files were really stored in <tt>/vol/data/.Trash-jmmv</tt>.  So why was it picking up the files from one directory but not from the other one?<br /><br />I started by looking for the <tt>.Trash</tt> string in gnome-vfs which led me to a piece of code that returns the trash directory for a given volume.  I first thought that there could be a problem detecting the home directory so I added some debugging messages there; everything looked correctly.<br /><br />After digging some more and thanks to the <tt>test/test-volume</tt> test utility, I ended up in the <tt>libgnomevfs/gnome-vfs-filesystem-type.c</tt> file.  This contains a table called <tt>fs_data</tt> that maps each file system name to a description and to a boolean.  The boolean indicates whether the file system is supposed to hold a trash or not.  As you can imagine, <tt>ffs</tt> was not part of this list, so the code felt back to the default values that specify that there was no trash.<br /><br />Solving the issue was trivial.  I just had to add the appropriate file system names to the table, rebuild gnome-vfs and experience the trash icon to its full power :-)   The issue is reported in <a href="http://bugzilla.gnome.org/show_bug.cgi?id=336533">bug #336533</a> and is already commited to pkgsrc.  Therefore, it will be part of the forthcoming pkgsrc-2006Q1 stable branch.
