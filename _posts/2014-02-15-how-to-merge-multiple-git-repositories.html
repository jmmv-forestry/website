---
layout: post
title: "How to merge multiple Git repositories into one"
date: 2014-02-15 16:08:00 -0500
categories: featured git kyua
julipedia: 2014/02/how-to-merge-multiple-git-repositories.html
excerpt_separator: </p>
---
<p>Are you looking for a method to merge multiple Git repositories into a single one?  If so, you have reached the right tutorial!</p> <p>Please bear with me for a second while I provide you with background information and introduce the subject of our experiments.  We'll get to the actual procedure soon and you will be able to apply it to any repository of your choice.</p> <hr /> <p>In the <a href="http://code.google.com/p/kyua/">Kyua project</a>, and with the introduction of the <tt>kyua-atf-compat</tt> component in the Summer of 2012, I decided to create independent Git repositories for each component.  The rationale was that, because each component would be shipped as a standalone distfile, they ought to live in their own repositories.</p> <p>Unfortunately, this approach is turning out to be a bit of an inconvenience: it is annoying to manage various repositories when the code of them all is supposed to be used in unison; it is hard to apply changes that cross component boundaries; and it is "impossible" to reuse code among the various components (e.g. share autoconf macros) in a clean manner â€” much less attempt to share the version number between them all.</p> <p>So what if all components lived in the same repository a la BSD but were still shipped as individual, fine-grained tarballs for packaging's sake?  Let's investigate.</p> <p><b>The goal</b></p> <p>Obviously, the goal is to get two or more Git repositories and merge them together.  It's particularly important to not mangle any existing commit IDs nor tags so that history is preserved intact.</p> <p>For the specifics of our example, Kyua has three repositories: one for <tt>kyua-cli</tt> (which is the default, unqualified repository in Google Code), one for <tt>kyua-atf-compat</tt> and one for <tt>kyua-testers</tt>.  The idea is to end up with a single repository that contains three top-level directories, one for each component, and all independent of each other (at least initially).</p> <p><b>Process outline</b></p> <p>The key idea to merge Git repositories is the following:</p> <ol><li>Select a repository to act as pivot.  This is the one into which you will merge all others.</li><li>Move the contents of the pivot repository into a single top-level directory.</li><li>Set up a new remote for the secondary repository to be merged.</li><li>Fetch the new remote and check it out into a new local branch.</li><li>Move the contents of the secondary repository into a single top-level directory.</li><li>Check out the master branch.</li><li>Merge the branch for the secondary repository.</li><li>Repeat from 3 for any additional repository to be merged.</li></ol> <p><b>Sounds good?  Let's get down to the surgery!</b></p> <p>We need to select a pivot.  For Kyua, this will be the default Google Code repository in <a href="https://code.google.com/p/kyua">https://code.google.com/p/kyua</a>.  Let's start by checking it out and moving all of its contents into a subdirectory:</p> <pre>$ git clone https://code.google.com/p/kyua<br />$ cd kyua<br />$ mkdir kyua-cli<br />$ git mv * kyua-cli<br />$ git commit -a -m "Move."</pre> <p>We are ready to start tackling the merge of a secondary repository.  I will use <a href="https://code.google.com/p/kyua.testers">https://code.google.com/p/kyua.testers</a> in this example.</p> <p>The first step is to pull in that secondary repository into our pivot:</p> <pre>$ git remote add origin-testers https://code.google.com/p/kyua.testers<br />$ git fetch origin-testers</pre> <p>And now, check it out into a temporary branch and move all of its contents into a subdirectory:</p> <pre>$ git branch merge-testers origin-testers/master<br />$ mkdir kyua-testers<br />$ git mv * kyua-testers<br />$ git commit -a -m "Move."</pre> <p>Done?  It's the time to merge the two repositories into one!</p> <pre>$ git checkout master<br />$ git merge merge-testers</pre> <p>And clean some stuff up.</p> <pre>$ git branch -d merge-testers<br />$ git remote remove origin-testers</pre> <p>Voil&agrave;.  It wasn't that hard, was it?  Just repeat the steps above for any other secondary repository you would like to merge.</p> <p><b>Parting words</b></p> <p>Note that this procedure achieves the goal of preserving the history of all individual repositories, the revision numbers and the tags.  In other words: all previous history is left intact and all commit logs remain valid after the merge.</p> <p>Do you know if there is any easier way of doing this?  Would it have any differences in the actual results?</p> <p>What do you think about doing the merge for Kyua?  I see this as a prerequisite for the migration to GitHub.</p>
