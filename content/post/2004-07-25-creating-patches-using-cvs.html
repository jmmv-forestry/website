---
title: "Creating patches using CVS"
date: 2004-07-25 10:27:00 -0400
julipedia: 2004/07/creating-patches-using-cvs.html
excerpt_separator: </p>
---
<p>Two days ago I introduced patch files. Let's see how to generate them when the sources you are modifying are controlled by a version management system: <a href="http://www.gnu.org/software/cvs/">CVS</a>.  (Note that others also have this feature; just read their documentation.)</p>  <p>Recalling the previous post, the common procedure to modify a source file, to later generate a patch, is to keep a backup of the original, like in:</p>  <pre>$ cp file.c file.c.orig<br />$ vi file.c<br />edit, edit, edit...<br />$ diff -u file.c.orig file.c > patch.diff</pre><p></p>  <p>This is acceptable if all you modify is a single file, but gets complicated when you have to patch many of them. Furthermore it may lead to "outdated" patches (which don't apply correctly to the latest version of the program).</p>  <p>But... if the sources you are modifying are controlled by CVS, things change completely. First of all, you don't have to save a copy of the original code, as it's already stored in the repository. That is, you can proceed to modify all the files you wish locally. So, how to generate the patch? All you have to do is run <tt>cvs diff -u</tt> from within the source directory. This will create a patch that includes the differences for all the files you've modified. The command accepts multiple (optional) arguments, which are the list of files (or directories) to be diffed (diffing the whole tree can be sloooow).</p>  <p>Once you do this, you'll note that the output generated by the command is slightly different from what I explained in the previous post (in fact, the header is bigger). Let's analyze a sample header:</p>  <pre>Index: sys/arch/i386/conf/GENERIC<br />===================================================================<br />RCS file: /cvsroot/src/sys/arch/i386/conf/GENERIC,v<br />retrieving revision 1.623<br />diff -u -r1.623 GENERIC<br />--- sys/arch/i386/conf/GENERIC  19 Jul 2004 14:23:59 -0000      1.623<br />+++ sys/arch/i386/conf/GENERIC  23 Jul 2004 12:39:16 -0000</pre><p></p>  <p>The first line shows which local file is beeing diffed (matches the name in the <tt>---</tt> line. The second, third and fourth lines give infomation about the file beeing retrieved from the CVS repository; in this case we can see that it picked up version 1.623 of the <tt>/cvsroot/src/sys/arch/i386/conf/GENERIC,v</tt> file, and that the diff command was called with the <tt>-u</tt> flag. The last two lines are as in regular patches. This information is there for the reader; the patch(1) utility will never use it.</p>  <p>Also note that generating patches from CVS (if available) gives a better impression to the person who has to review and apply the patch, so please use this feature.</p>  <p>For a complete example, check out <a href="ftp://ftp.netbsd.org/pub/NetBSD/misc/jmmv/msgattrs.diff">this</a> patch (which I'm quite proud of ;-) against the NetBSD repository.</p><p class="mobile-post"></p>
