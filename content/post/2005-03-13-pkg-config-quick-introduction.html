---
title: "pkg-config: A quick introduction"
date: 2005-03-13 13:04:00 -0500
julipedia: 2005/03/pkg-config-quick-introduction.html
excerpt_separator: </p>
---
<p>If you have ever tried to check for the presence of a library from a configuration script, you know this is not an easy task. Getting the right compiler (<tt>CFLAGS</tt>) and linker (<tt>LIBS</tt>) flags can be very difficult, if not impossible, without manual help from the user.</p>  <p>To detect some libraries, you have to create a little test program and link it against the library you are looking for. If the build is successful, the library is available, and possibly ready to be used. In fact, this is what <a href="http://www.gnu.org/software/autoconf/">GNU Autoconf</a>'s <tt>AC_CHECK_LIB</tt> macro does. However, this is not necessarily true, as the detected library may be older than you expected, or may need some extra flags that you didn't think of.</p>  <p>To overcome this difficulty, the <tt>*-config</tt> scripts were born. These scripts, specific to a library, print the required compiler and linker flags to the standard output, so that the configuration script can get them. For example, consider the <a href="http://www.gtk.org/">glib</a> 1.x library.  It includes the <tt>glib-config</tt> script, which produces the following output:</p>  <pre>[dawn jmmv] $ glib-config --cflags<br />-I/usr/pkg/include/glib/glib-1.2 -I/usr/pkg/lib/glib/include<br />[dawn jmmv] $ glib-config --libs<br />-L/usr/pkg/lib -Wl,-R/usr/pkg/lib -lglib</pre><p></p>  <p>This is certainly nicer than manual detection of libraries, but has a problem: each library has to provide its own script, which may be syntactically incompatible with all other ones (e.g., accepting an <tt>-ldflags</tt> flag rather than <tt>--libs</tt>).</p>  <p>And here is where <a href="http://www.freedesktop.org/Software/pkgconfig">pkg-config</a> comes into play: it generalizes the <tt>*-config</tt> scripts concept and provides a consistent framework to access library information.</p>  <p>In the pkg-config world, each library installs a special metadata file in a centralized directory (typically, <tt>lib/pkgconfig</tt> relative to the installation prefix). These files specify the version of the installed library, the compiler and linker flags needed to link to it as well as some other extra information. Then, the pkg-config utility can be used to consistently query this information.</p>  <p>The above glib example becomes the following:</p>  <pre>[dawn jmmv] $ pkg-config --cflags glib<br />-I/usr/pkg/include/glib/glib-1.2 -I/usr/pkg/lib/glib/include<br />[dawn jmmv] $ pkg-config --libs glib<br />-Wl,-R/usr/pkg/lib -L/usr/pkg/lib -lglib</pre><p></p>  <p>We can also ensure that a given version is present:</p>  <pre>[dawn jmmv] $ pkg-config --print-errors glib-2.0 ">=" 2.6.0<br />[dawn jmmv] $ pkg-config --print-errors glib-2.0 ">=" 2.10.0<br />Requested 'glib-2.0 >= 2.10.0' but version of GLib is 2.6.2</pre><p></p>  <p>Furthermore, this integrates nicely with configuration scripts generated by GNU Autoconf, as pkg-config provides a macro (<tt>PKG_CHECK_MODULES</tt>) to trivially query package information.</p>  <p>Unfortunately, not all libraries provide pkg-config metadata files (yet?), so you still need to fallback to the previous mechanisms if available. Furthermore, some people don't like pkg-config, but I can't see why. To me, it's a very neat concept (I'm not talking about its internal implementation, which may be messy) that greatly simplifies things.</p><p class="mobile-post"></p>
