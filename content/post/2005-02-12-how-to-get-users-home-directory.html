---
title: "How to get the user's home directory"
date: 2005-02-12 17:36:00 -0500
julipedia: 2005/02/how-to-get-users-home-directory.html
excerpt_separator: </p>
slug: how-to-get-users-home-directory
---
<p>Many programs need to access the user's home directory to look for files, specially configuration ones. To do that, they usually get the <tt>HOME</tt> environment variable's value and use it to construct the full path. However, if the application is security-sensible, this is probably inappropriate.</p>  <p>What happens if such application is run through <a href="http://www.courtesan.com/sudo/">sudo</a> or with the <tt>setuid</tt> bit set?  Let's see it:</p>  <pre>[dawn jmmv] $ sudo /bin/sh -c 'id -un ; echo ${HOME}'<br />root<br />/home/jmmv</pre><p></p>  <p>Oops! The application with extra privileges is getting the home directory of the unprivileged user! This is a serious problem, because the user could simply create a malicious configuration file (that exec's a third program, for example) and use it with more privileges than he has.</p>  <p>Fortunately, the user's home directory can be guessed using a safer method: that is, by reading its value from the <tt>/etc/passwd</tt> file.  We only need to be careful to get the entry that matches the actual <i>effective</i> user (not the <i>real</i> one).  How'd we do it?</p>  <pre>struct passwd *p = getpwuid(geteuid());<br />(void)printf("Home directory is: n", p->pw_dir);</pre><p></p>  <p>If we now put the above in a little test program and run it, we get:</p>  <pre>[dawn tmp] $ ./a.out<br />Home directory is: /home/jmmv<br />[dawn tmp] $ sudo ./a.out<br />Home directory is: /root</pre><p></p>  <p>Well, I'm not completely sure this is the best way to go (i.e., if there is any way to still get a value decided by the user), but so far I <i>think</i> this is safer than just reading <tt>HOME</tt>'s value.  If anybody knows of any drawbacks, please share!</p><p class="mobile-post"></p>
