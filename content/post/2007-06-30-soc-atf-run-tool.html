---
title: "SoC: The atf-run tool"
date: 2007-06-30 12:25:00 -0400
categories:
  - "atf"
  - "soc"
julipedia: 2007/06/soc-atf-run-tool.html
excerpt_separator: </p>
---
One of the key goals of <a href="http://netbsd-soc.sourceforge.net/projects/atf/">atf</a> is to let the <i>end user</i> — not <span style="font-style: italic;">only</span> the <i>developer</i> — to easily run the tests after their corresponding application is installed.  (In our case, application = NetBSD, but remember that atf also aims to be independent from NetBSD.) This also means, among other things, that the user must not need to have any development tool installed (the <tt>comp.tgz</tt> set) to run the tests, which rules out using make(1)... how glad I'm of that! :-)<br /><br />Based on this idea, each application using atf will install its tests alongside its binaries, being the currently location <tt>/usr/tests/&lt;application&gt;</tt>.  These tests will be accompanied by a control file — an <tt>Atffile</tt> — that lists which tests have to be run and in which order.  (In the future this may also include configuration or some other settings.)  Later on, the user will be able to launch the <b>atf-run</b> tool inside any of these directories to automatically run all the provided tests, and the tool will generate a pretty report while the tests are run.<br /><br />Given that atf is an application, it has to be tested.  After some work today, it is finally possible for atf to test itself! :-)  Of course, it also comes with several bootstrap tests, written using GNU Autotest, to ensure that atf's core functionality works before one can run the tests written using atf itself.  Otherwise one could get unexpected passes due to bugs in the atf code.<br /><br />This is what atf installs:<pre>$ find /tmp/local/tests<br />/tmp/local/tests<br />/tmp/local/tests/atf<br />/tmp/local/tests/atf/Atffile<br />/tmp/local/tests/atf/units<br />/tmp/local/tests/atf/units/Atffile<br />/tmp/local/tests/atf/units/t_file_handle<br />/tmp/local/tests/atf/units/t_filesystem<br />/tmp/local/tests/atf/units/t_pipe<br />/tmp/local/tests/atf/units/t_pistream<br />/tmp/local/tests/atf/units/t_postream<br />/tmp/local/tests/atf/units/t_systembuf<br />$</pre>All the <tt>t_*</tt> files are <i>test programs</i> written using the features provided by libatf.  As you can see, each directory provides an <tt>Atffile</tt> which lists the tests to run and the directories to descend into.<br /><br />The atf-run tool already works (*cough* it's code is ugly, really ugly) and returns an appropriate error code depending on the outcomes of the tests.  However, the report it generates is completely un-understandable.  This will be the next thing to attack: I want to be able to generate plain-text reports to be seen as the text progresses, but also to generate pretty HTML files.  To do the latter, the plan is to use some intermediate format such as XML and have another tool to do the formatting.
