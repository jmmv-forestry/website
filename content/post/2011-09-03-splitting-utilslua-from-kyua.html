---
title: "Splitting utils::lua from Kyua"
date: 2011-09-03 09:43:00 -0400
categories:
  - "c++"
  - "kyua"
  - "lua"
julipedia: 2011/09/splitting-utilslua-from-kyua.html
excerpt_separator: </p>
slug: splitting-utilslua-from-kyua
---
If you remember a post from January titled <a href="{{< relref "2011-01-08-c-interface-to-lua.html" >}}">C++ interface to Lua for Kyua</a> (wow, time flies), the Kyua codebase includes a small library to wrap the native Lua C library into a more natural C++ interface. You can take a look at the <a href="http://code.google.com/p/kyua/source/browse/#svn%2Ftags%2Fkyua-cli-0.2%2Futils%2Flua%253Fstate%253Dclosed">current code as of r129</a>.<br /><br />Quoting the previous post:<br /><blockquote>The utils::lua library provides thin C++ wrappers around the Lua C API  to ease the interaction between C++ and Lua.  These wrappers make  intensive use of RAII to prevent resource leakage, expose C++-friendly  data types, report errors by means of exceptions and ensure that the Lua  stack is always left untouched in the face of errors.  The library also  provides a place (the operations module) to add miscellaneous utility  functions built on top of the wrappers.</blockquote>While the RAII wrappers and other C++-specific constructions are a very nice thing to have, this library has to jump through a lot of hoops to interact with binary Lua versions built for C. This makes utils::lua not usable for performance-critical environments. Things would be way easier if utils::lua linked to a Lua binary built for C++, but unfortunately that is not viable in most, if not all, systems with binary packaging systems (read: most Linux distributions, BSD systems, etc.).<br /><br />That said, I've had requests from a bunch of people to provide utils::lua separately from Kyua regardless of any performance shortcomings it may have, and this is what I have started doing this weekend. So far, I already have a pretty clumsy standalone package (I'll keep the name to myself for now ;-) that provides this library on its own with the traditional Automake, Autoconf and Libtool support. Once this is a bit better quality, and once I modify Kyua to link against this external library and assess that things work fine, I'll make the decision on how to publish this (but most likely it should be a separate project in Google Code).<br /><br />Splitting the code doesn't come with its own issues though: maintaining a separate package will involve more work and hopefully/supposedly, dealing with quite a few feature requests to add missing functionality! Also, it means that utils::lua cannot use any of the other Kyua libraries (utils::sanity for example), so I lose a bit of consistency across the Kyua codebase. I am also not sure about how to share non-library code (in particular, the m4 macros for Autoconf) across the two packages.<br /><br />So, my question is: are you interested in utils::lua being shipped separately? :-)&nbsp; Do you have any cool use cases for it that you can share here?<br /><br />Thanks!
