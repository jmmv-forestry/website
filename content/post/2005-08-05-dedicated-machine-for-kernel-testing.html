---
title: "Dedicated machine for kernel testing"
date: 2005-08-05 06:19:00 -0400
julipedia: 2005/08/dedicated-machine-for-kernel-testing.html
excerpt_separator: </p>
slug: dedicated-machine-for-kernel-testing
---
<p>During the past month, I had to do all <a href="http://netbsd-soc.sourceforge.net/projects/tmpfs/">tmpfs</a> development on my laptop.  This includes coding and <i>testing</i>. If you have ever done any kernel hacking you know what this means: reboot every now and then to test your changes, which can drive you crazy after few reboots (specially if things keep breaking).</p>  <p>So when I got back home, the first thing I did was to set up a machine I had lying around for kernel testing exclusively. The machine is a Pentium 133Mhz with 32MB of RAM and a 3GB hard disk, more than enough for my purposes. (I'd have also used qemu... but since I had the hardware...)</p>  <p>Here are some details about its configuration, designed to minimize manual intervention:</p>  <ul> <li>The machine is in headless mode. I.e., no monitor nor keyboard and connected to my development machine using a null serial cable. I did all the installation of NetBSD over the serial line. In order to connect to it, I use the tip(1) command.</li>  <li>The machine uses <a href="http://www.gnu.org/software/grub/">GRUB</a> (also configured to use the serial line) to load the development kernel from my server and boot it, all of this in an unattended manner. Note that GRUB has some problems loading modern NetBSD kernels: some of them can be avoided by tweaking the configuration file, but others can't.</li>  <li>All services (e.g., sendmail, cron, inetd...) are disabled during startup to reduce boot time.</li>  <li>getty(8) is configured to automatically log in the root user.  This can be done through the <tt>al</tt> parameter in <tt>/etc/gettytab</tt>.</li>  <li>root's <tt>~/.profile</tt> fetches the new kernel again and installs it as <tt>/netbsd</tt>. Then, it asks me to press a key to run tmpfs regression tests afterward. (I made it require a key press to let me cancel the execution of tests if wanted.)</li>  <li>The development machine, after successful builds, uploads new kernels to the server from which GRUB fetches them.</li> </ul>  <p>With this setup, whenever I have built a new kernel in my development machine, I can instantly reboot the testing machine, press RETURN when asked for it and see the results. No need to copy the kernel to the second box in any way nor to enter any command!</p><p class="mobile-post"></p>
