---
title: "How to get the window size?"
date: 2005-03-03 15:06:00 -0500
julipedia: 2005/03/how-to-get-window-size.html
excerpt_separator: </p>
---
<p>Today, a friend of mine raised the issue of how to get the terminal window size from within a program. He had observed in his system an environment variable, called <tt>COLUMNS</tt>, which was automatically set to the window's width; that variable even changed when resizing the window.</p>  <p>But then we checked on two more systems (<a href="http://www.suse.com/">SuSE Linux</a> and <a href="http://www.netbsd.org/">NetBSD</a>) and we couldn't find the variable anywhere. I don't know where it's coming from in his system, but this is clearly not the way to go. So, how to do it?</p>  <p>The <tt>tty(4)</tt> driver has an ioctl for this specific purpose, i.e., to get the window size of an specific terminal.  It's called <tt>TIOCGWINSZ</tt> and has to be called over an open descriptor.  (I let to the reader the task to get information about <tt>TIOCSWINSZ</tt>.)</p>  <p>The next question is, which descriptor? It depends, but, usually, you'll want to get it from the descriptor on which you are going to write the output (<tt>STDOUT_FILENO</tt>).  Let's see a bit of code (slightly based on NetBSD's ps(1)):</p>  <pre>struct winsize ws;<br />unsigned short height, width;  <p>if ((ioctl(STDOUT_FILENO, TIOCGWINSZ, &ws) == -1 &amp;&<br />    ioctl(STDERR_FILENO, TIOCGWINSZ, &ws) == -1 &amp;&<br />    ioctl(STDIN_FILENO,  TIOCGWINSZ, &amp;ws) == -1) ||<br />    ws.ws_col == 0) {<br />   height = 25;<br />   width = 80;<br />} else {<br />   height = ws.ws_row;<br />   width = ws.ws_col;<br />}</p></pre><p></p>  <p>Now that we can get the terminal size on purpose, the next question is how to detect if the window size changes due to an external event - e.g., the user resized his terminal window. The only thing you need to do in this case is to catch the <tt>SIGWINCH</tt> signal (see <tt>signal(7)</tt>) and act accordingly; i.e., run the code shown above from inside the signal handler (or any other method you prefer to use, like delayed evaluation).</p>  <p>I guess this method is not extremely portable, but I'm sure it'll work on a lot more systems than the <tt>COLUMNS</tt> trick.</p><p class="mobile-post"></p>
