---
title: "Install Mac OS X over multiple volumes"
date: 2007-01-15 12:00:00 -0500
categories:
  - "macosx"
julipedia: 2007/01/install-mac-os-x-over-multiple-volumes.html
excerpt_separator: </p>
slug: install-mac-os-x-over-multiple-volumes
---
As you may already know, Mac OS X is a Unix-like system based on BSD and Mach.  Among other things, this means that there is a single virtual file system on which you can attach new volumes by means of mount points and the <tt>mount(8)</tt> utility.  One could consider partitioning a disk to place specific system areas in different partitions to prevent the degradation of each file system, but the installer does not let you do this (I suspect the one for Mac OS X Server might have this feature, but this is just a guess). Being Unix, this doesn't mean it isn't possible!<br /><br />As a demonstration, I explain here how to install Mac OS X so that the system files are placed in one partition and the users' home directories are in another one.  This setup keeps mostly-static system data self contained in a specific area of the disk and allows you to do a clean system reinstall without losing your data nor settings.<br /><br />First of all boot the installation from the first DVD and execute the <i>Disk Utility</i> from the <i>Utilities</i> menu.  There you can partition your disk as you want, so create a partition for the system and one for the users; let's call them <i>System</i> and <i>Users</i> respectively, being on the <tt>disk0s2</tt> and <tt>disk0s3</tt> devices.  Both should be HFS+, but you can choose whether you want journaling and/or case sensitivity independently.  Exit the tool and go back to the installer.<br /><br />Now do a regular install on the <i>System</i> volume, ignoring the existence of <i>Users</i>.  To make things simple, go through the whole installation, including the welcome wizard.  Once you are in the default desktop, get ready for the tricky stuff.<br /><br />Reboot your machine and enter single user mode by pressing and holding <b>Command+s</b> just after the initial chime sound.  At the command line, follow the instructions to remount the root volume as read/write.  If I recall correctly, it tells you to do:<pre># fsck -fy /<br /># mount -u rw /</pre>Mount the Users volume in a temporary location, copy the current contents of <tt>/Users</tt> into it and remove the original files.  For example:<pre># mkdir /Users2<br /># mount -t hfs /dev/disk0s3 /Users2<br /># rsync -avE /Users/ /Users2<br />... ensure that /Users2 matches /Users ...<br /># rm -rf /Users/.[a-zA-Z_]* /Users/*<br /># umount /Users2<br /># rmdir /Users2</pre>I used <tt>rsync(1)</tt> instead of <tt>cp(1)</tt> because it preserves the files' resource forks, if present (provided you give it the <tt>-E</tt> option).<br /><br />Once the data migration is done, you can proceed to tell the system to mount the <i>Users</i> volume in the appropriate place on the next boot.  Create the <tt>/etc/fstab</tt> file and add the following line to it:<pre>/dev/disk0s3 /Users hfs rw</pre>Ensure it works by mounting it by hand:<pre># mount /Users</pre>If no problems arise, you're done!  Reboot and enjoy your new system.<br /><br />The only problem with the above strategy is that your root volume must be big enough to hold the whole installation before you can reorganize the partitions.  I haven't tried it but maybe, just maybe, you could do some manual mounts from within the <i>Terminal</i> available in the installer. That way you'd set up the desired mount layout before any files are copied, delivering the appropriate results. Note that if this worked, you'd still need to do the <tt>fstab</tt> trick in this case, but you'd have to do it on the very first reboot, even before the install is complete!
