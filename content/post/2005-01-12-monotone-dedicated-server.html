---
title: "Monotone dedicated server"
date: 2005-01-12 08:36:00 -0500
julipedia: 2005/01/monotone-dedicated-server.html
slug: monotone-dedicated-server
---
<p>Some weeks ago, I installed <a href="http://www.venge.net/monotone/">Monotone</a> on my main machine to act as a dedicated server for <a href="http://vigipac.sourceforge.net/">Vigipac</a>'s source code.  During the process, I had to write a <tt>rc.d</tt> script and configure multiple things to get everything working safely. The overall process is not difficult once you know how Monotone works, but it is quite time consuming and error prone (due to concrete file permissions, for example). So I thought I could share my work to make this process easier to other people and love <a href="http://www.pkgsrc.org/">pkgsrc</a> even more ;-)</p>  <p>A simple way to achieve this could have been to include the <tt>rc.d</tt> script in the Monotone package, alongside a user and a group, using the marvelous <tt>bsd.pkg.install.mk</tt> framework. However, if I had gone this route, users of Monotone who only want it as a client would have an extra, useless user/group pair in their system. This is wrong, IMHO.</p>  <p>So the other possible approach was to create a new package that provided all the needed bits to make the configuration of a dedicated server as painless as possible. And this is what I've done. The package is named, for obvious reasons, <tt><a href="http://cvsweb.netbsd.org/bsdweb.cgi/pkgsrc/devel/monotone-server/">monotone-server</a></tt>, and is found in pkgsrc's <tt><a href="http://cvsweb.netbsd.org/bsdweb.cgi/pkgsrc/devel/">devel</a></tt> category.</p>  <p>Basically, all it does is install a <tt>rc.d</tt> script, register a user/group pair (<tt>monotone:monotone</tt>) to run the server as and provide a home-grown script (<tt>monotone-server-init</tt>) to initialize the database. Furthermore, it installs a template file containing the required hooks to authenticate clients against branches and also provides a mechanism to easily define the set of branches (collections) to share (through an "invented" <tt>branches.conf</tt> file).</p>  <p>What does the <tt>monotone-server-init</tt> script do, you say?  Well, it asks you where the database should be created (which defaults to <tt>/var/monotone/monotone.db</tt>), creates it, generates a key pair to access the server and tells you what to do to end the configuration. All in an interactive and self-explanatory process.</p>  <p>Hope it's useful to someone :-)</p><p class="mobile-post"></p>
