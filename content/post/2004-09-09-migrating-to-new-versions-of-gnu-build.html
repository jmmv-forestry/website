---
title: "Migrating to new versions of the GNU Build System"
date: 2004-09-09 08:29:00 -0400
julipedia: 2004/09/migrating-to-new-versions-of-gnu-build.html
excerpt_separator: </p>
---
<p>The GNU Build System is basically composed of <a href="http://www.gnu.org/software/autoconf/">GNU Autoconf</a> and <a href="http://www.gnu.org/software/automake/">GNU Automake</a>. The latest versions of these tools are 2.59 and 1.9.1 respectively, at the moment of this writing. Compared to 2.13 and 1.4, these are <i>far better</i>, although not completely compatible with the previous ones. However, if you are maintaining a software project which uses these two tools, you should consider updating to the latest versions, as your program will be more portable and easier to manage.</p>  <p>Let's discuss some of the changes you'll need to do in the <tt>configure.ac</tt> or <tt>configure.in</tt> file (note that the first name is preferred):</p>  <ul> <li>The <tt>AC_INIT</tt> macro now takes four arguments (the last two are optional). The first one is the full name of the package in its full form; for example <i>XML Catalog Manager</i>; the second one is its version; the third one an email address where bugs should be reported; and the last one is the package name in its short form, like <i>xmlcatmgr</i>. Check out the GNU Autoconf manual for more details, because the last parameter can be automatically derived from the first if you follow some rules.</li>  <li>Be sure to set <tt>AC_PREREQ</tt> to <tt>2.59</tt>, so that GNU Autoconf knows if it should parse the file or not.</li>  <li>Since <tt>AC_INIT</tt> does not take a file name to verify if the script is being run from the appropiate directory, you have to use the <tt>AC_CONFIG_SRCDIR</tt> macro to achieve the same thing.</li>  <li>Optionally set <tt>AC_COPYRIGHT</tt> to a copyright string that should appear in the generated configure script, to take credit for your work.</li>  <li>The <tt>AM_INIT_AUTOMAKE</tt> macro now takes a whitespace separated list of options to pass to GNU Automake.  My suggestion is that you add the following: <tt>1.9</tt>, which specifies the minimum version of the utility needed; <tt>-Wall</tt>, which turns on multiple warning messages; <tt>check-news</tt>, which verifies that your <tt>NEWS</tt> file describes the changes for the latest version; and <tt>no-define</tt>, which avoids defining the <tt>PACKAGE</tt> and <tt>VERSION</tt> macros in the configuration header (these two are deprecated anyway).</li>  <li>When formatting help strings, required by the <tt>AC_ARG_ENABLE</tt> and <tt>AC_ARG_WITH</tt> macros, use the <tt>AS_HELP_STRING</tt> macro.  This ensures that the text appears properly aligned when calling <tt>./configure --help</tt>.</li> </ul>  <p>The <tt>Makefile.am</tt> files will also need some tweaks:</p>  <ul> <li>Remove <tt>AUTOMAKE_OPTIONS</tt> assignments, since we have specified them in the <tt>AM_INIT_AUTOMAKE</tt> macro.</li>  <li>Rename the <tt>INCLUDES</tt> variable to <tt>AM_CPPFLAGS</tt>.</li> </ul>  <p>At last, since we are passing the <tt>no-define</tt> option to GNU Automake, you'll have to do some minor changes in your source files:</p>  <ul> <li>Where you need to specify the full package name, use <tt>PACKAGE_NAME</tt>.</li> <li>Where you need to specify the package version, use <tt>PACKAGE_VERSION</tt>.</li> <li>Where you need to specify the full package name, together with its version, use <tt>PACKAGE_STRING</tt>.</li> <li>Where you need to specify the short package name (usually, when calling functions like <tt>bindtextdomain</tt>), use <tt>PACKAGE_TARNAME</tt>.</li> <li>As a rule of thumb, replacing <tt>PACKAGE</tt> with <tt>PACKAGE_TARNAME</tt> and <tt>VERSION</tt> with <tt>PACKAGE_VERSION</tt> should produce the same results as before. However, the new macros allow more flexibility, so you can replace some hardcoded strings in your sources.</li> </ul>  <p>Well... and that's all you need to get started. You may want to do other changes while you are at it, but you should now have a good idea of what needs to be done. Let's code!</p><p class="mobile-post"></p>
