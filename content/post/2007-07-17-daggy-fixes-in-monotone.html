---
title: "Daggy fixes (in Monotone)"
date: 2007-07-17 06:30:00 -0400
categories:
  - "atf"
  - "monotone"
julipedia: 2007/07/daggy-fixes-in-monotone.html
slug: daggy-fixes-in-monotone
---
If you inspect the <a href="http://mtn-host.prjek.net/viewmtn/atf/branch/changes/org.NetBSD.atf.src">ATF's source code history</a>, you'll see a lot of merges.  But why is that, if I'm the <i>only</i> developer working in the project?  Shouldn't the revision history be <i>linear</i>?<br /><br />Well, the thing is it <i>needn't</i> and it <i>shouldn't</i>; the subtle difference is important here :-)  It <i>needn't</i> be linear because <a href="http://monotone.ca/">Monotone</a> is a VCS that stores history in a <a href="http://en.wikipedia.org/wiki/Directed_acyclic_graph">DAG</a>, so it is completely natural to have a non-linear history.  In fact, distributed development requires such a model if you want to preserve the original history (instead of stacking changes on top of revisions different than the original ones).<br /><br />On the other hand, it <i>shouldn't</i> be linear because there are better ways to organize the history.  As the <a href="http://www.venge.net/mtn-wiki/DaggyFixes">DaggyFixes</a> page in the <a href="http://www.venge.net/mtn-wiki/">Monotone Wiki</a> mentions:<br /><blockquote>All software has bugs, and not all changes that you commit to a source tree are entirely good. Therefore, some commits can be considered "development" (new features), and others can be considered "bugfixes" (redoing or sometimes undoing previous changes). It can often be advantageous to separate the two: it is common practice to try and avoid mixing new code and bugfixes together in the same commit, often as a matter of project policy. This is because the fix can be important on its own, such as for applying critical bugfixes to stable releases without carrying along other unrelated changes.</blockquote>The key idea here is that you should group bug fixes alongside the original change that introduced them, if it is clear which commit is that and you can easily locate it.  And if you do that, you end up with a non-linear history that requires a merge per each bug-fix to resolve the divergences inside a single branch.<br /><br />I certainly recommend you to read the <a href="http://www.venge.net/mtn-wiki/DaggyFixes">DaggyFixes</a> page.  One more reason to do the switch to Monotone (or any other DAG-based VCS system, of course)? ;-)  Oh, I now notice I once <a href="http://julipedia.blogspot.com/2005/10/monotone-using-mini-branches-to-apply.html">blogged about this same idea</a>, but that page is far more clear than my explanation.<br /><br />That is why you'll notice lots of merges in the ATF source tree: I've started applying this methodology to see how well it behaves and I find it very interesting so far.  I'd now hate switching to CVS and losing all the history for the project (because attempting to convert it to CVS's model could be painful), even if it is that not interesting.
