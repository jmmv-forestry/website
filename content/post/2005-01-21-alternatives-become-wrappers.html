---
title: "Alternatives become wrappers"
date: 2005-01-21 15:19:00 -0500
julipedia: 2005/01/alternatives-become-wrappers.html
excerpt_separator: </p>
---
<p>Todd Vierling made some interesting <a href="http://mail-index.netbsd.org/tech-pkg/2005/01/20/0023.html">suggestions</a> about the alternatives stuff. I didn't like them at first, but the more I thought about them, the more I realized they were the way to go :-P</p>  <p>So I've rewritten the alternatives framework almost from scratch, to make it use little wrappers instead of symbolic links (you can forget most things from the previous post, specially the example code). For those that don't know it, a <i>wrapper</i> is a little program that encapsulates another one; it does some preliminary tasks, but ends up running the program it's wrapping. Here are some of the advantages of using wrappers (really, some of them are only due to the new implementation):</p>  <ul> <li><p>They don't break if the original program disappears. How can this happen, if the alternatives are managed by packages?. Suppose you have <tt>/usr/pkg</tt> shared among several computers, but PKG_SYSCONFDIR is local to them (say <tt>/etc/pkg</tt>).  Having this scenario, you have <tt>nvi</tt> set as the default for <tt>vi</tt> on machine A, while you have <tt>vim</tt> on machine B. If you remove one of them from one system, the other machine will end up with dangling symbolic links.</p>  <p>Wrappers, however, check a list of alternatives when they are run and walk the entire list looking for a valid candidate. This means that the problem described above cannot happen (and if it does, you get a nice error message).</p></li>  <li><p>If you have multiple candidates available and you choose one manually to be the default, you want it to stay as the default even if you deinstall the package (think on updates, for example). This is now possible, and in fact very easy to achieve.</p></li>  <li><p>They let the user (not the administrator) configure which utility to use in each case. I.e., the wrapper will first look inside the <tt>~/.alternatives</tt> directory for settings, then inside <tt>PKG_SYSCONFDIR</tt>, and at last inside the database stored in <tt>PREFIX/libdata/alternatives</tt>.</p>  <p>The first two locations are optional and can be edited by hand at will (or even through the alternatives utility). The later one, though, is only managed by packages at (de)install time.</p></li>  <li><p>They don't "break" if the application changes its behavior depending on <tt>argv[0]</tt>.  With symbolic links, you cannot use <tt>gvim</tt> as an alternative for <tt>vi</tt> (in fact, you can, but you won't get the graphical window).</p></li>  <li><p>Alternatives can have command line arguments.  Todd showed an example: "<tt>emacs -l vip</tt>" as an alternative for <tt>vi</tt>.</p></li> </ul>  <p>There are some disadvantages too. The main one is that wrappers are restricted to programs. I.e., you cannot use them to provide alternatives for other stuff such as documentation, libraries, manual pages... But anyway, supporting these is not really a good idea if you think about it. However, one could argue about manual pages; I've mitigated this problem by generating one for each wrapper on the fly. They are simple, but I think can solve the inconvenient fairly well.</p>  <p>Check this <a href="http://mail-index.netbsd.org/tech-pkg/2005/01/21/0015.html">message</a> for some more information as well to links to the existing implementation.</p><p class="mobile-post"></p>
