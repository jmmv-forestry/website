---
title: "Guessing Tcl/Tk configuration"
date: 2005-02-08 10:40:00 -0500
julipedia: 2005/02/guessing-tcltk-configuration.html
slug: guessing-tcltk-configuration
---
<p>When a program uses <a href="http://tcl.sourceforge.net/">Tcl</a> and/or Tk, its configuration script (if any) has to check for the presence of these libraries and retrieve some information about them, such as their version, the required link flags, etc. Unfortunately, the process to achieve this is rather obscure (AFAIK), thus it is unknown by many people. This results in unportable (and broken) configuration scripts.</p>  <p>So how is this done? Both libraries install a shell script which carries all the required information, so all you have to do is find the script, read it, and use the variables you need. These scripts are named <tt>tclConfig.sh</tt> and <tt>tkConfig.sh</tt> respectively, and are placed in the <tt>lib</tt> directory relative to their installation prefix.  I.e., most of the times, they'll be placed in <tt>/usr/lib</tt>, <tt>/usr/local/lib</tt> or other locations such as <tt>/usr/pkg/lib</tt> in <a href="http://www.netbsd.org/">NetBSD</a>.</p>  <p>Let's see a bit of code that shows how to get Tcl's link flags using <a href="http://www.gnu.org/software/autoconf/">GNU Autoconf</a>:</p>  <pre>AC_ARG_WITH(tcl,<br />           AS_HELP_STRING(--with-tcl=PREFIX, [Enable Tcl support]),,<br />           with_tcl=yes)<br />if test ${with_tcl} != no; then<br />   if test ${with_tcl} = yes; then<br />       tcl_dirs="/usr/local /usr"<br />   else<br />       tcl_dirs="${with_tcl}"<br />   fi<br /><br />   AC_MSG_CHECKING(for tclConfig.sh script)<br />   found=no<br />   for d in ${tcl_dirs}; do<br />       if test -f ${d}/lib/tclConfig.sh; then<br />           found=yes<br />           break<br />       fi<br />   done<br />   AC_MSG_RESULT(${found})<br /><br />   if test ${found} = no; then<br />       AC_MSG_ERROR(Tcl support requested but the library cannot<br />                    be found)<br />   fi<br />   . ${d}/lib/tclConfig.sh<br />   AC_MSG_NOTICE(using "${TCL_LIBS}" to link to Tcl)<br />   AC_SUBST(TCL_LIBS)<br />fi</pre><p></p>  <p>The above code snippet does the following:</p>  <ol> <li>It defines a command line argument (<tt>--with-tcl</tt>) to enable or disable Tcl support.  This flag accepts a directory name as its argument (aside <tt>yes</tt> and <tt>no</tt>) which is treated as Tcl's installation prefix.  Note that, if Tcl support was <i>not optional</i>, you'd use <tt>AC_ARG_VAR</tt> to specify the prefix rather than a flag (because neither of "enable" nor "with" semantics match what you'd want to do).</li>  <li>If Tcl was enabled, it checks whether the user gave a path or simply let the argument take its default value. In the later case, the script falls back to a sane list of directories; otherwise, <i>only</i> the directory given by the user is used.</li>  <li>It walks the directory list looking for a <tt>tclConfig.sh</tt> script and, when found, stops the process.</li>  <li>If the script wasn't found, the configuration is aborted with a descriptive error message.</li>  <li>If the script was found, it's read and the <tt>TCL_LIBS</tt> variable is added to the substitution list so that it's available from the Makefiles. We'd do this for any other variable provided by the script. At this point, you'd also check for the detected version (<tt>TCL_VERSION</tt> and other variables) and compare it to your requisites.</li> </ol>  <p>Of course, all of the above also applies to Tk, just changing the name of one library for the other.</p><p class="mobile-post"></p>
