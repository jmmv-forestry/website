---
title: "C++: Constructors and global data"
date: 2005-10-12 07:27:00 -0400
julipedia: 2005/10/c-constructors-and-global-data.html
excerpt_separator: </p>
slug: c-constructors-and-global-data
---
<p>As a general rule of thumb, accessing global data from within class constructors is a dangerous operation and ought to be avoided. The C++ specification does not describe the order in which global variables are initialized, so there are high chances that your constructor accesses uninitialized data, producing unexpected resultsn (e.g., crashes in some circumstances).</p>  <p>It is important to remark this. This behavior is undefined, so it can change across compilers and/or architectures. If your code relies on it, it's broken: something that apparently works on one machine may not work on another one.</p>  <p>Let's see an example.  First of all, consider an <tt>Integer</tt> class that wraps an integer (like Java's one) and a <tt>Foo</tt> class with a not-yet-specified constructor:</p>  <pre>class Integer {<br />   int m_value;<p>public:<br />   Integer(int v) { m_value = v; }<br />   int get_value(void) { return m_value; }<br />};  </p><p>class Foo {<br />public:<br />   Foo(void);<br />};</p></pre><p></p>  <p>Up to this point, everything is correct. Now, given that both classes are usable, we declare two global variables, one of each type:</p>  <pre>static Integer Global_Integer(5);<br />static Foo Global_Foo;</pre><p></p>  <p>As these are objects, the C++ runtime will call their constructors when initializing them, but we can't predict the order in which this will happen.</p>  <p>Now we define <tt>Foo's</tt> constructor body, which accesses and prints <tt>Global_Integer</tt>'s value:</p>  <pre>Foo::Foo(void)<br />{<br />   std::cout &lt;&lt; Global_Integer.get_value() &lt;&lt; std::endl;<br />}</pre><p></p>  <p>With this done, if you add an empty <tt>main</tt> function and run the program, you should see an integer; it will be <i>probably</i> be 5 (at least with GNU G++ 4.0.1 on a Linux/powerpc box), but it may not. Whichever value you get, try reversing the variable declaration lines, defining <tt>Global_Foo</tt> first and see if the results change (I get 0 in this box).</p>  <p>Clear? OK, this example is extremely simple, but imagine if this same structure was split among multiple files and classes in a large project... You couldn't easily predict what happens under the hood.</p><p class="mobile-post"></p>
